<h1 id="how-to-parse-mmcif-files-using-biojava">How to parse mmCIF files using BioJava</h1>

<h2 id="what-is-mmcif">What is mmCIF?</h2>

<p>The Protein Data Bank (PDB) has been distributing its archival files as
PDB files for a long time. The PDB file format is based on
“punchcard”-style rules how to store data in a flat file. With the
increasing complexity of macromolecules that have are being resolved
experimentally, this file format can not be used any more to represent
some or the more complex structures. As such, the wwPDB recently
announced the transition from PDB to mmCIF/PDBx as the principal
deposition and dissemination file format (see
<a href="http://www.wwpdb.org/news/news_2013.html#22-May-2013">here</a> and
<a href="http://wwpdb.org/workshop/wgroup.html">here</a>).</p>

<p>The mmCIF file format has been around for some time (see
<a href="#westbrook2000" title="wikilink">1</a>,<a href="#westbrook2003" title="wikilink">2</a> )
<a href="http://www.biojava.org">BioJava</a> has been supporting mmCIF already for
several years. This tutorial is meant to provide a quick introduction
into how to parse mmCIF files using <a href="http://www.biojava.org">BioJava</a></p>

<h2 id="the-basics">The basics</h2>

<p>BioJava provides you with both a mmCIF parser and a data model that
reads PDB and mmCIF files into a biological and chemically meaningful
data model. If you don’t want to use that data model, you can still use
BioJava’s file parsers, and more on that later, let’s start first with
the most basic way of loading a protein structure.</p>

<h2 id="quick-installation">Quick Installation</h2>

<p>Before we start, just one quick paragraph of how to get access to
BioJava.</p>

<p>BioJava is open source and you can get the code from
<a href="https://github.com/biojava/biojava">Github</a>, however it might be easier
this way:</p>

<p>BioJava uses <a href="http://maven.apache.org/">Maven</a> as a build and
distribution system. If you are new to Maven, take a look at the
<a href="http://maven.apache.org/guides/getting-started/index.html">Getting Started with
Maven</a> guide.</p>

<p>As of version 4, BioJava is available in maven central. Thus you just
need to include this in your pom.xml file:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>        &lt;dependencies&gt;
                ...
                &lt;dependency&gt;
                        &lt;groupId&gt;org.biojava&lt;/groupId&gt;
                        &lt;artifactId&gt;biojava-structure&lt;/artifactId&gt;
                        &lt;version&gt;4.0.0-SNAPSHOT&lt;/version&gt;
                &lt;/dependency&gt;
                &lt;!-- other biojava jars as needed --&gt;
        &lt;/dependencies&gt;
</code></pre>
</div>

<p>If you run ‘mvn package’ on your project, the BioJava dependencies will
be automatically downloaded and installed for you.</p>

<h2 id="first-steps">First steps</h2>

<p>The simplest way to load a PDB file is by using the
<a href="http://www.biojava.org/docs/api/org/biojava3/structure/StructureIO.html">StructureIO</a>
class.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    Structure structure = StructureIO.getStructure("4HHB");
    // and let's print out how many atoms are in this structure
    System.out.println(StructureTools.getNrAtoms(structure));
</code></pre>
</div>

<p>BioJava automatically downloaded the PDB file for hemoglobin
<a href="http://www.rcsb.org/pdb/explore.do?structureId=4HHB">4HHB</a> and copied
it into a temporary location. This demonstrates two things:</p>

<ul>
  <li>BioJava can automatically download and install files locally</li>
  <li>BioJava by default writes those files into a temporary location (The
system temp directory “java.io.tempdir”).</li>
</ul>

<p>If you already have a local PDB installation, you can configure where
BioJava should read the files from by setting the PDB_DIR system
property</p>

<div class="highlighter-rouge"><pre class="highlight"><code>    -DPDB_DIR=/wherever/you/want/
</code></pre>
</div>

<p>or by setting an environment variable</p>

<div class="highlighter-rouge"><pre class="highlight"><code>export PDB_DIR=/wherever/you/want/
</code></pre>
</div>

<p>Note that the layout of files in those directories will mimick the
“divided” layout in the official PDB ftp repository.</p>

<h2 id="from-pdb-to-mmcif">From PDB to mmCIF</h2>

<p>By default BioJava is using the PDB file format for parsing data. In
order to switch it to use mmCIF, we can take control over the underlying
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/align/util/AtomCache.html">AtomCache</a>
which manages your PDB (and btw. also SCOP, CATH) installations.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>        AtomCache cache = new AtomCache();
            
        cache.setUseMmCif(true);
            
        // if you struggled to set the PDB_DIR property correctly in the previous step, 
        // you could set it manually like this:
        cache.setPath("/tmp/");
            
        StructureIO.setAtomCache(cache);
            
        Structure structure = StructureIO.getStructure("4HHB");
                    
        // and let's count how many chains are in this structure.
        System.out.println(structure.getChains().size());
</code></pre>
</div>

<p>As you can see, the AtomCache will again download the missing mmCIF file
for 4HHB in the background.</p>

<h2 id="low-level-access">Low level access</h2>

<p>By default the file content will be loaded into the BioJava data
structures. The parser contains a built-in event model, which allows to
load your own, custom data structures. For this you will require to
implement the <a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/io/mmcif/MMcifConsumer.html">MMcifConsumer
interface</a></p>

<java> @since 1.7

`   public static void main(String[] args){`

`       String fileName = args[0];`  
`       `  
`       InputStream inStream =  new FileInputStream(fileName);`  
`       `  
`       MMcifParser parser = new SimpleMMcifParser();`

`       SimpleMMcifConsumer consumer = new SimpleMMcifConsumer();`

`       // The Consumer builds up the BioJava - structure object.`  
`               // you could also hook in your own and build up you own data model.          `  
`       parser.addMMcifConsumer(consumer);`

`       try {`  
`           parser.parse(new BufferedReader(new InputStreamReader(inStream)));`  
`       } catch (IOException e){`  
`           e.printStackTrace();`  
`       }`

`               // now get the protein structure.`  
`       Structure cifStructure = consumer.getStructure();`  
`                     `

}

</java>

<p>The parser operates similar to a XML parser by triggering “events”. The
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/io/mmcif/SimpleMMcifConsumer.html">SimpleMMcifConsumer</a>
listens to new categories being read from the file and then builds up
the BioJava data model.</p>

<p>To re-use the parser for your own datamodel, just implement the
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/io/mmcif/MMcifConsumer.html">MMcifConsumer</a>
interface and add it to the
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/io/mmcif/SimpleMMcifParser.html">SimpleMMcifParser</a>.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>        parser.addMMcifConsumer(myOwnConsumerImplementation);
</code></pre>
</div>

<p>For more info on how to work with the BioJava structure data model see</p>
<biojava:cookbook:pdb:atoms>.

References
----------

<biblio>

1.  westbrook2000 pmid=10842738
2.  westbrook2003 pmid=12647386

</biblio>
</biojava:cookbook:pdb:atoms>

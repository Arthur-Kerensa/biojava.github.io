<h1 id="how-to-write-a-plugin-for-dazzle">How to write a plugin for Dazzle</h1>

<h2 id="the-source-code">The source code</h2>

<p>The full source code for this example is available from <a href="http://www.derkholm.net/svn/repos/dazzle/trunk/src/org/biojava/servlets/dazzle/datasource/UniProtDataSource.java">the dazzle svn
repository</a></p>

<h2 id="how-to-set-up-a-reference-and-annotation-server">How to set up a Reference and Annotation server</h2>

<p>This example demonstrates how to set up a reference &amp; annotation server
for Dazzle using the BioJava sequence model. There is also a second way
to provide features, which is using a simple GFF style bean object.
(Documentation to follow).</p>

<p>Step 1: declare what we want to implement. As you can see below, we want
to implement a ReferenceSource and we use the convenience class
AbstractDataSource, so we safe some time for the implmementation.</p>

<java> public class UniProtDataSource extends AbstractDataSource
implements DazzleReferenceSource { </java>

<p>These objects will collect the data: <java></java></p>

<p><code class="highlighter-rouge">   private Map seqs; // contains all the BioJava Sequence objects.</code><br />
<code class="highlighter-rouge">   private Set allTypes; // all annotation types.</code><br />
<code class="highlighter-rouge">   String fileName; // the filename to parse</code></p>

<p>&lt;/java&gt;</p>

<p>When the DAs source is requested, Dazzle will initiate this plugin. For
this the init method is called:</p>

<java>

`   public void init(ServletContext ctx) `  
`   throws DataSourceException`  
`   {`  
`       super.init(ctx);`  
`       try {`  
`                    `

</java>

<p>Now we init the variables and use BioJava to parse the uniprot file:</p>

<java>

`           seqs = new HashMap();`  
`           allTypes = new HashSet();`  
`           BufferedReader br = new BufferedReader(new InputStreamReader(ctx.getResourceAsStream(fileName)));`

// read the SwissProt File

`           SequenceIterator sequences = SeqIOTools.readSwissprot(br);`

`           //iterate through the sequences`  
`           while(sequences.hasNext()){`

`               Sequence seq = sequences.nextSequence();`  
`           `  
`               seqs.put(seq.getName(), seq);`  
`           }`

</java>

<p>If something goes wrong, we throw a DataSourceException</p>

<java>

`       } catch (Exception ex) {`  
`           throw new DataSourceException(ex, "Couldn't load sequence file");`  
`       }`  
`   }`

`   /** try to parse a score out of the feature notes`  
`    * `  
`    */`  
`   public String getScore(Feature f) {`  
`       String score = "-";`

`       Annotation a = f.getAnnotation();`  
`       try {`  
`           `  
`           String note = (String) a.getProperty("swissprot.featureattribute");`  
`           `  
`           int scorePos =note.indexOf("Score: "); `  
`           if (  scorePos &gt; 0 ) {`

`               String sc = note.substring(scorePos+7,note.length());`  
`               //System.out.println("parsed " + sc);`  
`               try {`  
`                   double scp  = Double.parseDouble(sc);`  
`                   score = "" + scp;`  
`               } catch (Exception e){`  
`                   e.printStackTrace();`  
`               }`  
`               try {`  
`                   int scp = Integer.parseInt(sc);`  
`                   score = "" + scp;`  
`               } catch (Exception e){ `  
`                   e.printStackTrace();`  
`               }`  
`               `  
`           }`  
`           `  
`           //score = ""+ (Double)a.getProperty(SCORE);`  
`           System.out.println("found score " + score);`  
`       } catch (NoSuchElementException e){`  
`           // igonre in this case...`  
`       }`  
`       return score;`

`   }`

</java>

<p>Now some simple methods to provide some data to be returned to the user.</p>

<java>

`   public String getDataSourceType() {`

`       return "UniProtFile";`  
`   }`

`   public String getDataSourceVersion() {`

`       return "1.00";`  
`   }`

</java>

<p>This method is called, since in dazzecfg.xml we configured the filename
attribute.</p>

<java>

`   public void setFileName(String s) {`  
`       fileName = s;`  
`   }`

</java>

<p>And this method is called when the DAS - SEQUENCE command is being
called:</p>

<java>

`   public Sequence getSequence(String ref) throws DataSourceException, NoSuchElementException {`  
`       Sequence seq = (Sequence) seqs.get(ref);`  
`       if (seq == null) {`  
`           throw new NoSuchElementException("No sequence " + ref);`  
`       }`  
`       return seq;`  
`   }`

`   public Set getAllTypes() {`  
`       return Collections.unmodifiableSet(allTypes);`  
`   }`

</java>

<p>and here now the method that is used for the ENTRYPOINTS command</p>

<java>

`   public Set getEntryPoints() {`  
`       return seqs.keySet();`  
`   }`

`   public String getMapMaster() {`  
`       // TODO Auto-generated method stub`  
`       return null;`  
`   }`

`   public String getLandmarkVersion(String ref) throws DataSourceException, NoSuchElementException {`  
`       // TODO Auto-generated method stub`  
`       return null;`  
`   }`

} </java>

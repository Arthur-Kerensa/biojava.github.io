<p><strong>by <a href="Dickson Guedes" title="wikilink">Dickson S. Guedes</a></strong></p>

<p>There are many questions in the mailing lists about “How to perform a
Multiple Sequence Alignment using BioJava”, but Biojava DOESN’T make
multi-alignments by itself, so I’ll post some code that I’ve created in
my theses.</p>

<p>Ok. Let’s Go…</p>

<p>First, this is how you call methods from ClustalWAlign’s class.</p>

<p><strong>MultAlignTest.java</strong></p>

<java> /\*\*

`* MultAlignTest.java`  
`* `  
`* @author Dickson S. Guedes (guedes@unisul.br)`  
`* @author Israel S. de Medeiros (israelbrz@gmail.com)`  
`* @version 1.0 `  
`* @serialData 20060120 `  
`* `  
`* Copyright (c) 2006.`  
`* `  
`*/`

import org.biojava.bio.seq.DNATools; import
org.biojava.bio.seq.Sequence; import
org.biojava.bio.seq.SequenceIterator;

public class MultAlignTest {

`   public static void main(String[] args) {`  
`       try {`  
`           // First create an instance for ClustalWAlign`  
`           ClustalWAlign alSequences = new ClustalWAlign("FakeSequencesFile");`  
`           `  
`           // Now only add Sequences to alSequences`  
`           alSequences.addSequence(DNATools.createDNASequence("atttagatgatatatcggccactagcatcgactacgactgacatcgt","Sequence1"));`  
`           alSequences.addSequence(DNATools.createDNASequence("atagatgatggccatcgatcgagacgggatgactgacgtacgt","Sequence2"));`  
`           alSequences.addSequence(DNATools.createDNASequence("atagatgatggccatcgatcgaagacggatgactgacgtacgt","Sequence3"));`  
`           alSequences.addSequence(DNATools.createDNASequence("atagatgatggccatggatgactgacgtacgt","Sequence4"));`  
`           alSequences.addSequence(DNATools.createDNASequence("atagatgatggccatccgatgaggacgtacgt","Sequence5"));`

`           // Here you are calling the core of class - The Multi-Alignment!`  
`           alSequences.doMultAlign();`

`           // Now, you want to see results. Well...`  
`           SequenceIterator it = alSequences.getIterator();`  
`           `  
`           while (it.hasNext()) {`  
`               Sequence seq = it.nextSequence();`  
`               System.out.println(seq.getName() + ": " + seq.seqString());`  
`           }`  
`           `  
`           System.out.print("GUIDE TREE:" + alSequences.getGuideTree());`  
`           `  
`       } catch (Throwable t) {`  
`           t.printStackTrace();`  
`       }`  
`   }`

} </java>

<p>Now, the class that calls ClustalW as a external process:</p>

<p><strong>ClustalWAlign.java</strong> <java> /\*\*</java></p>

<p><code class="highlighter-rouge">* ClustalWAlign.java</code><br />
<code class="highlighter-rouge">* </code><br />
<code class="highlighter-rouge">* @author Dickson S. Guedes (guedes@unisul.br)</code><br />
<code class="highlighter-rouge">* @author Israel S. de Medeiros (israelbrz@gmail.com)</code><br />
<code class="highlighter-rouge">* @version 1.0 </code><br />
<code class="highlighter-rouge">* @serialData 20060120 </code><br />
<code class="highlighter-rouge">* </code><br />
<code class="highlighter-rouge">* Copyright (c) 2006.</code><br />
<code class="highlighter-rouge">* </code><br />
<code class="highlighter-rouge">*/</code></p>

<p>import java.io.BufferedInputStream; import java.io.BufferedReader;
import java.io.FileInputStream; import java.io.FileOutputStream; import
java.io.FileReader; import java.io.IOException; import
java.io.InputStream; import java.io.InputStreamReader;</p>

<p>import org.biojava.bio.BioException; import
org.biojava.bio.seq.Sequence; import
org.biojava.bio.seq.SequenceIterator; import
org.biojava.bio.seq.db.HashSequenceDB; import
org.biojava.bio.seq.db.SequenceDB; import
org.biojava.bio.seq.io.SeqIOTools; import
org.biojava.bio.symbol.AlphabetManager; import
org.biojava.utils.ChangeVetoException;</p>

<p>public class ClustalWAlign {</p>

<p><code class="highlighter-rouge">   // This are Constants, but I'll change...</code><br />
<code class="highlighter-rouge">   private static final String fileFormat = "fasta";</code><br />
<code class="highlighter-rouge">   private static final String clustalwPath = "C:\\JAVA\\Workspace\\clustalw\\";</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   private SequenceDB      dbSequences;</code><br />
<code class="highlighter-rouge">   private String          strAlfa;</code><br />
<code class="highlighter-rouge">   private String          fileName;</code><br />
<code class="highlighter-rouge">   private String          guideTree;</code><br />
<code class="highlighter-rouge">   </code></p>

<p><code class="highlighter-rouge">   public ClustalWAlign () {</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       this.dbSequences = new HashSequenceDB();</code><br />
<code class="highlighter-rouge">       this.strAlfa = "DNA";</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public ClustalWAlign (String fileName) {</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       this.dbSequences = new HashSequenceDB();</code><br />
<code class="highlighter-rouge">       this.strAlfa = "DNA";</code><br />
<code class="highlighter-rouge">       this.fileName = fileName;</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public ClustalWAlign (SequenceIterator itSequences, String strAlfa) throws BioException, ChangeVetoException {</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       this.dbSequences = new HashSequenceDB();</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       this.strAlfa = strAlfa;</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       while (itSequences.hasNext()) {</code><br />
<code class="highlighter-rouge">           this.dbSequences.addSequence(itSequences.nextSequence());</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public ClustalWAlign (BufferedReader bufSequences, String strAlfa) throws BioException, ChangeVetoException {</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       this.dbSequences = new HashSequenceDB();</code><br />
<code class="highlighter-rouge">       this.strAlfa = strAlfa;</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       SequenceIterator itSequences = (SequenceIterator)SeqIOTools.fileToBiojava(fileFormat,strAlfa,bufSequences); </code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       while (itSequences.hasNext()) {</code><br />
<code class="highlighter-rouge">           this.dbSequences.addSequence(itSequences.nextSequence());</code><br />
<code class="highlighter-rouge">       }       </code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public void addSequence(Sequence seqSequence) throws BioException, ChangeVetoException {</code><br />
<code class="highlighter-rouge">       this.dbSequences.addSequence(seqSequence);</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public void removeSequence(String idSequence) throws BioException, ChangeVetoException {</code><br />
<code class="highlighter-rouge">       this.dbSequences.removeSequence(idSequence);</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public int doMultAlign() {  </code><br />
<code class="highlighter-rouge">       int exitVal=999;</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       try {</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           FileOutputStream newFile = new FileOutputStream(clustalwPath + fileName + ".input");</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           SeqIOTools.writeFasta(newFile,this.dbSequences);</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           Runtime rt = Runtime.getRuntime();</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           String [] strComando =  </code><br />
<code class="highlighter-rouge">                               {clustalwPath+"ClustalW.EXE",</code><br />
<code class="highlighter-rouge">                               "/infile="  + clustalwPath + fileName + ".input",</code><br />
<code class="highlighter-rouge">                               "/outfile=" + clustalwPath + fileName + ".output",</code><br />
<code class="highlighter-rouge">                               "/output=" + fileFormat,</code><br />
<code class="highlighter-rouge">                               "/align"};</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           Process proc = rt.exec(strComando);</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           InputStream stdin = proc.getInputStream();</code><br />
<code class="highlighter-rouge">           BufferedReader br = new BufferedReader(new InputStreamReader(stdin));</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           while ( (br.readLine()) != null) {</code><br />
<code class="highlighter-rouge">               // do nothing only read "stdout" from ClustalW</code><br />
<code class="highlighter-rouge">                               // you can put a System.out.print here to prints</code><br />
<code class="highlighter-rouge">                               // the output from ClustalW to console.</code><br />
<code class="highlighter-rouge">           }</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           exitVal = proc.waitFor();</code><br />
<code class="highlighter-rouge">           if (exitVal == 0) {</code><br />
<code class="highlighter-rouge">               this.dbSequences = SeqIOTools.readFasta(</code><br />
<code class="highlighter-rouge">                       new BufferedInputStream(</code><br />
<code class="highlighter-rouge">                               new FileInputStream(</code><br />
<code class="highlighter-rouge">                                       clustalwPath + </code><br />
<code class="highlighter-rouge">                                       fileName + </code><br />
<code class="highlighter-rouge">                               ".output")),</code><br />
<code class="highlighter-rouge">                               AlphabetManager.alphabetForName(strAlfa)</code><br />
<code class="highlighter-rouge">               );</code><br />
<code class="highlighter-rouge">               </code><br />
<code class="highlighter-rouge">               this.guideTree = fileToString(</code><br />
<code class="highlighter-rouge">                                       clustalwPath + </code><br />
<code class="highlighter-rouge">                                       fileName + </code><br />
<code class="highlighter-rouge">                                       ".dnd"</code><br />
<code class="highlighter-rouge">                                       );</code><br />
<code class="highlighter-rouge">           }</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       } catch (Throwable t) {</code><br />
<code class="highlighter-rouge">           t.printStackTrace();</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       return (exitVal);</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">   public void setAlphabet(String strAlfa) {</code><br />
<code class="highlighter-rouge">       this.strAlfa = strAlfa;</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public SequenceDB getDBSequences() {</code><br />
<code class="highlighter-rouge">       return this.dbSequences;</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public SequenceIterator getIterator() {</code><br />
<code class="highlighter-rouge">       return this.dbSequences.sequenceIterator();</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   public String getGuideTree() {</code><br />
<code class="highlighter-rouge">       return guideTree;</code><br />
<code class="highlighter-rouge">   }</code></p>

<p><code class="highlighter-rouge">   public void setGuideTree(String guideTree) {</code><br />
<code class="highlighter-rouge">       this.guideTree = guideTree;</code><br />
<code class="highlighter-rouge">   }   </code><br />
<code class="highlighter-rouge">   </code><br />
<code class="highlighter-rouge">   private String fileToString(String fileName) {</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       String fileBody = "";</code><br />
<code class="highlighter-rouge">       boolean endOfFile = false;</code><br />
<code class="highlighter-rouge">       </code><br />
<code class="highlighter-rouge">       try {</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           FileReader fileClustalW = new FileReader(fileName);</code><br />
<code class="highlighter-rouge">           BufferedReader fileBuffer = new BufferedReader(fileClustalW);</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">           while (!endOfFile) {</code><br />
<code class="highlighter-rouge">               String fileLine = fileBuffer.readLine();</code><br />
<code class="highlighter-rouge">               </code><br />
<code class="highlighter-rouge">               if (fileLine == null) {</code><br />
<code class="highlighter-rouge">                   endOfFile = true;</code><br />
<code class="highlighter-rouge">               } else {</code><br />
<code class="highlighter-rouge">                   fileBody = fileBody.concat(fileLine);</code><br />
<code class="highlighter-rouge">               }</code><br />
<code class="highlighter-rouge">           }</code><br />
<code class="highlighter-rouge">           fileBuffer.close();</code><br />
<code class="highlighter-rouge">           </code><br />
<code class="highlighter-rouge">       } catch (IOException e) {</code><br />
<code class="highlighter-rouge">           e.printStackTrace();</code><br />
<code class="highlighter-rouge">       }</code></p>

<p><code class="highlighter-rouge">       return fileBody;</code><br />
<code class="highlighter-rouge">   }</code></p>

<p>} &lt;/java&gt;</p>

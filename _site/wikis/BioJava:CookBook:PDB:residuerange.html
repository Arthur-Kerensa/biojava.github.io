<h3 id="how-to-calculate-the-true-length-of-a-range-of-residues">How to calculate the true length of a range of residues</h3>

<p>Insertion codes pose a problem when calculating length–the number of
residues between two residues in the same chain. For example, the
following method may return an incorrect result; <java> int
getLength(String string) {</java></p>

<p><code class="highlighter-rouge">   Atom[] ca = cache.getAtoms(string);</code><br />
<code class="highlighter-rouge">   int start = ca[0].getGroup().getResidueNumber().getSeqNum();</code><br />
<code class="highlighter-rouge">   int end = ca[ca.length-1].getGroup().getResidueNumber().getSeqNum();</code><br />
<code class="highlighter-rouge">   return end - start;</code></p>

<p>} &lt;/java&gt;</p>

<p>Instead, use
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/AtomPositionMap">AtomPositionMap</a>
and
<a href="http://www.biojava.org/docs/api/org/biojava/bio/structure/ResidueRange">ResidueRange</a>:</p>
<java> int getLength(String string) {

`   AtomPositionMap map = AtomPositionMap.ofAminoAcids(cache.getAtoms(string));`  
`   ResidueRange range = ResidueRange.parse(string, map);`  
`   System.out.println(range.getLength()); // will print the correct length`

} </java>

<p>The above method won’t give the best performance if you’re calling it
for multiple structures from the same PDB Id. Instead, it is better to
reuse, creating only one AtomPositionMap per PDB Id.</p>

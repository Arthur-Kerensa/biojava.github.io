<h2 id="how-to-make-a-biojava-release">How to make a BioJava release</h2>

<p>This page is intended for BioJava release managers. I was documenting
this while I was doing the BioJava 1.7
release. –<a href="User:Andreas" title="wikilink">Andreas</a> 15:14, 12 April 2009 (UTC)</p>

<h3 id="required-time">Required time</h3>

<p>A few hours. Most time is being spent in verifying that the code base is
release ready. The actual preparation of the .jar files and copying them
to the open-bio.org server is quite quick and can be done
semi-automatic.</p>

<h3 id="prior-to-release">Prior to release</h3>

<ul>
  <li>Announce release deadlines on mailing list</li>
  <li>Run optimize imports across whole project</li>
  <li>Make sure all java classes have the copyright statement by running
this shell script: <biojava:ensurecopyrightheader></biojava:ensurecopyrightheader></li>
</ul>

<h3 id="configure-authentication-keys">Configure Authentication Keys</h3>

<p>You need to configure the following 3 items for performing a full
release 1) OSS Sonatype login (OSS Jira account login) 2) PGP signature
for code signing (only can upload signed jars to OSS Sonatype) 3) SSH
keys for cloudportal.open-bio.org</p>

<h4 id="oss-sonatype-login">OSS Sonatype login</h4>

<p>As of release 4.0.0 we moved our repository hosting from biojava’s web
server to Maven Central. To push releases there, you need to first get
an account set up at the <a href="https://issues.sonatype.org">OSS Sonatype
Jira</a>. One of the people who already have
permission (currently @andreasprlic and @heuermh) can request to add you
to the already existing biojava project. The BioJava pom.xml is set up
correctly to upload the jars for you, as long as you set up your login:</p>

<p>You need to configure maven with your username and identity file. In
~/.m2/settings.xml (on the build machine), add or merge the following
xml:</p>

<settings xmlns="http://maven.apache.org/SETTINGS/1.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemalocation="http://maven.apache.org/SETTINGS/1.0.0
     http://maven.apache.org/xsd/settings-1.0.0.xsd">  
`    `<localrepository />  
`    `<interactivemode />  
`    `<usepluginregistry />  
`    `<offline />  
`    `<plugingroups />  
`    `<mirrors />  
`    `<proxies />  
`    `<profiles />  
`    `<activeprofiles />  
`    `<servers>  
`        `<server>  
`            `<id>`ossrh`</id>  
`            `<username>`username`</username>  
`            `<password>`pwd`</password>  
`        `</server>  
`    `</servers>  
</settings>

<p>Maven reports ‘Auth Error’ in the release:perform stage if you keys are
not properly set up. Permissions errors mean that authentication was
successful but you can not write to the correct location (for instance,
if a maven-metadata.xml exists from a previous build by another user).</p>

<p>More information about using the Maven release plugin to push to OSS
Sonatype is
[<a href="http://blog.sonatype.com/2013/09/simplified-releases-to-the-central-repository-with-nexus/">http://blog.sonatype.com/2013/09/simplified-releases-to-the-central-repository-with-nexus/</a>#.VMsj7l7F-kc
here].</p>

<h4 id="biojava-web-server-ssh-key">BioJava web server SSH key</h4>

<p>To complete the release you need permission to scp files to the maven
repository on cloudportal.open-bio.org. If you need help with that, talk
to root@open-bio.org. Make sure you have ssh keys set up to log in, and
that you are a member of the apache group so that you can write to the
web directory.</p>

<h4 id="pgp-signature">PGP Signature</h4>

<p>Set up a PGP signature for code signing. For documentation how to do
this see <a href="https://www.gnupg.org/gph/en/manual/c14.html">here</a>.</p>

<h2 id="on-release-date">On release date</h2>

<p><strong>Verify code base</strong></p>

<ul>
  <li>Make sure code is ready for release. Check last minute commits
(there usually are some).</li>
  <li>Make sure the auto-build page (cruisecontrol) does not report any
problems</li>
</ul>

<h2 id="clean-checkout">Clean checkout</h2>

<p>Create a clean clone on a machine with ssh keys set up to access
cloudportal.open-bio.org (and associated maven settings; see above).</p>

<p><code class="highlighter-rouge">git clone git@github.com:biojava/biojava.git bj3.0.7</code></p>

<h3 id="make-maven-release">Make maven release</h3>

<p>the release process is very straightforward nowadays. It is rather
time-consuming, as maven runs all tests during each step.</p>

<p><code class="highlighter-rouge">mvn release:clean </code><br />
<code class="highlighter-rouge">mvn release:prepare </code><br />
<code class="highlighter-rouge">mvn release:perform</code></p>

<p>The second and third steps set up your local git repository and deploy
jar files for each module to cloudportal. If something goes wrong, you
can technically run `mvn release:rollback`, but it is easier to just
reset your git repository to master.</p>

<p><code class="highlighter-rouge">git reset --hard origin/master</code></p>

<p>AP: I recommend NOT to do git reset, once files have been uploaded to
sonatype. release:rollback will clean up for you.</p>

<h3 id="push-to-github">Push to Github</h3>

<p>If all three steps work fine, the maven release plugin will push on your
behalf to Github and release the jars on OSS Sonatype. Note:</p>
<mvn:release> takes about 1 hour since the bandwith to upload at OSS
Sonatype is limited.

If there is a problem, here how to add the release tag by hand:

push the tag to github and merge it to releases. Note that I'm assuming
origin refers to the central biojava repository.

<span style="color:red">Note: double check these commands</span>

`git pull master #merge any commits that occurred while releasing`  
`git push --tags origin master #push the new master (with updated pom) and new tags`

`git checkout release`  
`git merge biojava-3.0.7`  
`git diff biojava-3.0.7 release #shouldn't print anything`  
`git push origin release`

And here how to delete a release tag again:

`git tag -d biojava-3.0.7 `  
`git push origin :refs/tags/biojava-3.0.7`

### Prepare and release javadoc files

(Still in git checkout, e.g. bj3.0.7 if you're following along or
biojava/target/checkout/ if you did not mvn clean in the meanwhile)

build javadoc:

`mvn site`

Here we assume the version nr. of the current release is 3.0.7.

` cd target/site/`  
` mv apidocs/ api3.0.7`  
` tar czvf api3.0.3.tar.gz api3.0.7/`  
` scp api3.0.7.tar.gz username@cloudportal.open-bio.org:/home/websites/biojava.org/html/static/docs/`

now log into the couldportal server:

`ssh andreas@cloudportal.open-bio.org`  
  
`cd /home/websites/biojava.org/html/static/docs/`  
`tar zxvf api3.0.7.tar.gz`  
`rm api`  
`ln -s api3.0.7 api`

and back to your local machine...

### Create the biojava-all bundle

If needed, rename your git checkout to bj3.0.7

`mv checkout/ bj3.0.7`

remove .git files

`rm -rf .git .gitignore .travis.yml KEYS ignore.txt`

Create -all tarball

`cd ..`  
`tar czvf bj3.0.7-all.tar.gz bj3.0.7`  

on portal.open-bio

`mkdir /home/websites/biojava.org/html/static/download/bj3.0.7`

back to your local machine

`scp biojava-3.0.7-all.tar.gz andreas@cloudportal.open-bio.org:/home/websites/biojava.org/html/static/download/bj3.0.7`

### Javadocs

this is how to enable analytics in javadocs

`cd biojava-svn/target/bj3.0.7/`

`mvn clean install source:jar javadoc:jar javadoc:aggregate`

`cd biojava-svn/target/bj3.0.7/target/site/apidocs`

upload apidocs

### Update the wiki pages to link to the new release

Create a new download file for the release. (I copied
<biojava:download_3.0.4> to <biojava:download_3.0.5>). Modify the new
page to the latest data.

Update <biojava:download> (Change the redirect on the BioJava:Download
page to <biojava:download_3.0.5>)

Update [Template:Current version](Template:Current version "wikilink"),
which should change all the references on the home page, sidebar, etc.

Double check that there are no additional references to the old version
using an
[&lt;http://biojava.org/w/index.php?title=Special%3ASearch&amp;profile=advanced&amp;fulltext=Search&amp;ns0=1&amp;ns4=1&amp;redirs=1&amp;search&gt;=
Advanced Search].

### AND FINALLY

Write release announcement to biojava-l and biojava-dev
</biojava:download_3.0.5></biojava:download></biojava:download_3.0.5></biojava:download_3.0.4></mvn:release>

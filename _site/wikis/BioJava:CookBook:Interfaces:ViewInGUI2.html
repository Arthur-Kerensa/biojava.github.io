<p>When building a bioinformatics GUI you will probably want to display the
sequence of residues and features in the Sequence you are displaying.
BioJava contains a number of GUI components that can render various
aspects of a Sequence.</p>

<p>The basic unit of any Sequence based GUI is the SequenceRenderContext
which holds the Sequence and sends instructions to a SequenceRenderer
which does the actual drawing of the Sequence. There are several
SequenceRenderer implementations in BioJava.</p>

<p>The following program demonstrates how to load an EMBL sequence file as
a RichSequence. Two SequenceRenderers are generated from this
RichSequence both filtered for CDS features and then filtered again for
either forward or reverse strand orientation. These are added to a
MultiLineRenderer as are a RulerRenderer and a SymbolSequenceRenderer.
The RulerRenderer displays the sequence coordinates and the
SymbolSequenceRenderer displays the sequence. The sequence display is
limited by the sequenceScale parameter of the TranslatedSequencePanel
and so is not always visible.</p>

<p>Once loaded, the sequence and CDS features displayed can be controlled
by the buttons in the JPanel controlPanel. These use the
setSequenceScale and setSymbolTranslation methods of the
TranslatedSequencePanel to modify the view.</p>

<p>Lastly, there is a SequenceViewerMotionListener added to the
TranslatedSequencePanel which triggers a ToolTip to display the name of
the gene when the mouse is over a CDS feature.</p>

<p><img src="Viewer ScreenShot.JPG" alt="" title="fig:Viewer ScreenShot.JPG" /> <java> /\*\*</java></p>

<p><code class="highlighter-rouge">* Class to load an EMBL sequence file and display it in a viewer.</code><br />
<code class="highlighter-rouge">*/</code></p>

<p>//Java libraries import java.awt.*; import java.awt.event.*; import
java.io.*; import java.util.*; import javax.swing.*; //BioJava
libraries import org.biojava.bio.*; import org.biojava.bio.seq.*;
import org.biojava.bio.gui.sequence.*; //BioJava extension libraries
import org.biojavax.*; import org.biojavax.ontology.*; import
org.biojavax.bio.seq.*;</p>

<p>public class DisplaySequenceFile extends JFrame implements
SequenceViewerMotionListener {</p>

<p><code class="highlighter-rouge"> private TranslatedSequencePanel tsp = new TranslatedSequencePanel();</code><br />
<code class="highlighter-rouge"> private MultiLineRenderer mlr = new MultiLineRenderer();</code><br />
<code class="highlighter-rouge"> private RulerRenderer rr = new RulerRenderer();</code><br />
<code class="highlighter-rouge"> private SequenceRenderer seqr = new SymbolSequenceRenderer();</code><br />
<code class="highlighter-rouge"> private FeatureBlockSequenceRenderer fbsr;</code><br />
<code class="highlighter-rouge"> private RichSequence richSeq;</code></p>

<p><code class="highlighter-rouge"> private Container con;</code><br />
<code class="highlighter-rouge"> private JPanel controlPanel;</code><br />
<code class="highlighter-rouge"> private JButton mvLeft, mvRight, zoomIn, zoomOut;</code><br />
<code class="highlighter-rouge"> private double sequenceScale = 0.05;</code><br />
<code class="highlighter-rouge"> private int windowWidth = 1200;</code><br />
<code class="highlighter-rouge"> private int windowHeight = 200;</code></p>

<p><code class="highlighter-rouge"> public DisplaySequenceFile(String fileName){</code><br />
<code class="highlighter-rouge">   super("Display Rich Sequence File");</code><br />
<code class="highlighter-rouge">   //Load the sequence file</code><br />
<code class="highlighter-rouge">   try {</code><br />
<code class="highlighter-rouge">     richSeq = RichSequence.IOTools.readEMBLDNA(new BufferedReader(new FileReader(new File(fileName))), null).nextRichSequence();</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   catch (BioException bioe){</code><br />
<code class="highlighter-rouge">     System.err.println("Not an EMBL sequence");</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   catch(FileNotFoundException fnfe){</code><br />
<code class="highlighter-rouge">      System.err.println("FileNotFoundException: " + fnfe);</code><br />
<code class="highlighter-rouge">   }</code><br />
<code class="highlighter-rouge">   catch (IOException ioe){</code><br />
<code class="highlighter-rouge">     System.err.println("IOException: " + ioe);</code><br />
<code class="highlighter-rouge">   }</code></p>

<p><code class="highlighter-rouge">   //Define the appearance of the rendered Features</code><br />
<code class="highlighter-rouge">   BasicFeatureRenderer bfr = new BasicFeatureRenderer();</code><br />
<code class="highlighter-rouge">   GradientPaint gradient = new GradientPaint(0, 10, Color.RED, 0, 0, Color.white, true);</code><br />
<code class="highlighter-rouge">   bfr.setFill(gradient);</code><br />
<code class="highlighter-rouge">   bfr.setOutline(Color.RED);</code></p>

<p><code class="highlighter-rouge">   //Form a bridge between Sequence rendering and Feature rendering</code><br />
<code class="highlighter-rouge">   fbsr = new FeatureBlockSequenceRenderer(bfr);</code><br />
<code class="highlighter-rouge">   fbsr.setCollapsing(false);</code></p>

<p><code class="highlighter-rouge">   //Filter for CDS features on the forward strand</code><br />
<code class="highlighter-rouge">   SequenceRenderer fwd_sr = new FilteringRenderer(fbsr,</code><br />
<code class="highlighter-rouge">           new FeatureFilter.And(new FeatureFilter.ByType("CDS"),</code><br />
<code class="highlighter-rouge">           new FeatureFilter.StrandFilter(StrandedFeature.POSITIVE)),</code><br />
<code class="highlighter-rouge">           true);</code><br />
<code class="highlighter-rouge">   //Filter for CDS features on the reverse strand</code><br />
<code class="highlighter-rouge">   SequenceRenderer rev_sr = new FilteringRenderer(fbsr,</code><br />
<code class="highlighter-rouge">           new FeatureFilter.And(new FeatureFilter.ByType("CDS"),</code><br />
<code class="highlighter-rouge">           new FeatureFilter.StrandFilter(StrandedFeature.NEGATIVE)),</code><br />
<code class="highlighter-rouge">           true);</code></p>

<p><code class="highlighter-rouge">   //Add the renderers to the MultiLineRenderer</code><br />
<code class="highlighter-rouge">   mlr.addRenderer(fwd_sr);</code><br />
<code class="highlighter-rouge">   mlr.addRenderer(rr);</code><br />
<code class="highlighter-rouge">   mlr.addRenderer(rev_sr);</code><br />
<code class="highlighter-rouge">   mlr.addRenderer(seqr);</code></p>

<p><code class="highlighter-rouge">   //Set the sequence renderer for the TranslatedSequencePanel</code><br />
<code class="highlighter-rouge">   tsp.setRenderer(mlr);</code><br />
<code class="highlighter-rouge">   //Set the sequence to render</code><br />
<code class="highlighter-rouge">   tsp.setSequence(richSeq);</code><br />
<code class="highlighter-rouge">   //Set the position of the displayed sequence</code><br />
<code class="highlighter-rouge">   tsp.setSymbolTranslation(1);</code><br />
<code class="highlighter-rouge">   //Set the scale as pixels per Symbol.</code><br />
<code class="highlighter-rouge">   tsp.setScale(sequenceScale);</code></p>

<p><code class="highlighter-rouge">   //Add a sequence viewer motion listener to the TranslatedSequencePanel</code><br />
<code class="highlighter-rouge">   tsp.addSequenceViewerMotionListener(this);</code></p>

<p><code class="highlighter-rouge">   //Generate the control panel</code><br />
<code class="highlighter-rouge">   controlPanel = new JPanel();</code><br />
<code class="highlighter-rouge">   controlPanel.setBackground(Color.lightGray);</code><br />
<code class="highlighter-rouge">   //Move along the sequence towards 5' end</code><br />
<code class="highlighter-rouge">   mvLeft = new JButton("&lt;&lt;");</code><br />
<code class="highlighter-rouge">   mvLeft.addActionListener(new ActionListener(){</code><br />
<code class="highlighter-rouge">     public void actionPerformed(ActionEvent ae){</code><br />
<code class="highlighter-rouge">       int rightSide = tsp.getRange().getMax();</code><br />
<code class="highlighter-rouge">       int leftSide = tsp.getRange().getMin();</code><br />
<code class="highlighter-rouge">       int newStartPoint = leftSide - (rightSide - leftSide);</code><br />
<code class="highlighter-rouge">       if (newStartPoint &lt; 1){</code><br />
<code class="highlighter-rouge">         newStartPoint = 1;</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       tsp.setSymbolTranslation(newStartPoint);</code><br />
<code class="highlighter-rouge">     }</code><br />
<code class="highlighter-rouge">   });</code><br />
<code class="highlighter-rouge">   //Move along the sequence towards 3' end</code><br />
<code class="highlighter-rouge">   mvRight = new JButton("&gt;&gt;");</code><br />
<code class="highlighter-rouge">   mvRight.addActionListener(new ActionListener(){</code><br />
<code class="highlighter-rouge">     public void actionPerformed(ActionEvent ae){</code><br />
<code class="highlighter-rouge">       int rightSide = tsp.getRange().getMax();</code><br />
<code class="highlighter-rouge">       int leftSide = tsp.getRange().getMin();</code><br />
<code class="highlighter-rouge">       int screenWidth = rightSide - leftSide;</code><br />
<code class="highlighter-rouge">       if ((rightSide + screenWidth) &gt;= richSeq.length()){</code><br />
<code class="highlighter-rouge">         tsp.setSymbolTranslation(richSeq.length() - screenWidth);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       else {</code><br />
<code class="highlighter-rouge">         tsp.setSymbolTranslation(rightSide);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">     }</code><br />
<code class="highlighter-rouge">   });</code><br />
<code class="highlighter-rouge">   //Increase sequence scale</code><br />
<code class="highlighter-rouge">   zoomIn = new JButton("+");</code><br />
<code class="highlighter-rouge">   zoomIn.addActionListener(new ActionListener(){</code><br />
<code class="highlighter-rouge">     public void actionPerformed(ActionEvent ae){</code><br />
<code class="highlighter-rouge">       sequenceScale = sequenceScale * 2;</code><br />
<code class="highlighter-rouge">       //if sequence scale = 12 the bases are rendered</code><br />
<code class="highlighter-rouge">       //no need to zoom in further so disable the button.</code><br />
<code class="highlighter-rouge">       if (sequenceScale &gt; 12){</code><br />
<code class="highlighter-rouge">         sequenceScale = 12;</code><br />
<code class="highlighter-rouge">         zoomIn.setEnabled(false);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       tsp.setScale(sequenceScale);</code><br />
<code class="highlighter-rouge">     }</code><br />
<code class="highlighter-rouge">   });</code><br />
<code class="highlighter-rouge">   //Reduce sequence scale</code><br />
<code class="highlighter-rouge">   zoomOut = new JButton("-");</code><br />
<code class="highlighter-rouge">   zoomOut.addActionListener(new ActionListener(){</code><br />
<code class="highlighter-rouge">     public void actionPerformed(ActionEvent ae){</code><br />
<code class="highlighter-rouge">       sequenceScale = sequenceScale / 2;</code><br />
<code class="highlighter-rouge">       //if sequence scale is below 12 the enable zoomIn button</code><br />
<code class="highlighter-rouge">       if (sequenceScale &lt; 12){</code><br />
<code class="highlighter-rouge">         zoomIn.setEnabled(true);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       //If the scale allows more than the sequence to be displayed</code><br />
<code class="highlighter-rouge">       //display the whole sequence</code><br />
<code class="highlighter-rouge">       if (sequenceScale &lt; ((double)tsp.getWidth()/(double)richSeq.length())){</code><br />
<code class="highlighter-rouge">         sequenceScale = (double)tsp.getWidth()/(double)richSeq.length();</code><br />
<code class="highlighter-rouge">         tsp.setSymbolTranslation(1);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">       tsp.setScale(sequenceScale);</code><br />
<code class="highlighter-rouge">       //If the new scale coupled with the current SymbolTranslation means the</code><br />
<code class="highlighter-rouge">       //displayed sequence can't fill the TranslatedSequencePanel then reset </code><br />
<code class="highlighter-rouge">       //the SymbolTranlstion to allow for this</code><br />
<code class="highlighter-rouge">       if(tsp.getRange().getMax() &gt;= richSeq.length()){</code><br />
<code class="highlighter-rouge">         int tmp = (int)((double)tsp.getWidth()/sequenceScale);</code><br />
<code class="highlighter-rouge">         tsp.setSymbolTranslation(richSeq.length() - tmp);</code><br />
<code class="highlighter-rouge">       }</code><br />
<code class="highlighter-rouge">     }</code><br />
<code class="highlighter-rouge">   });</code><br />
<code class="highlighter-rouge">   controlPanel.add(mvLeft);</code><br />
<code class="highlighter-rouge">   controlPanel.add(mvRight);</code><br />
<code class="highlighter-rouge">   controlPanel.add(zoomIn);</code><br />
<code class="highlighter-rouge">   controlPanel.add(zoomOut);</code></p>

<p><code class="highlighter-rouge">   con = new Container();</code><br />
<code class="highlighter-rouge">   con = getContentPane();</code><br />
<code class="highlighter-rouge">   con.setLayout(new BorderLayout());</code><br />
<code class="highlighter-rouge">   con.add(controlPanel, BorderLayout.NORTH);</code><br />
<code class="highlighter-rouge">   con.add(tsp, BorderLayout.CENTER);</code><br />
<code class="highlighter-rouge">   setLocation(50,50);</code><br />
<code class="highlighter-rouge">   setSize(windowWidth,windowHeight);</code><br />
<code class="highlighter-rouge">   setVisible(true);</code><br />
<code class="highlighter-rouge">   setResizable(false);</code><br />
<code class="highlighter-rouge"> }</code></p>

<p><code class="highlighter-rouge"> /**</code><br />
<code class="highlighter-rouge">  * Detect mouse dragged events</code><br />
<code class="highlighter-rouge">  * @param sve</code><br />
<code class="highlighter-rouge">  */</code><br />
<code class="highlighter-rouge"> public void mouseDragged(SequenceViewerEvent sve) {</code><br />
<code class="highlighter-rouge"> }</code></p>

<p><code class="highlighter-rouge"> /**</code><br />
<code class="highlighter-rouge">  * Detect mouse mouse moved events</code><br />
<code class="highlighter-rouge">  * If the mouse moves over a CDS feature create a tooltiptext stating the</code><br />
<code class="highlighter-rouge">  * the name of the gene associated with the CDS feature.</code><br />
<code class="highlighter-rouge">  * @param sve</code><br />
<code class="highlighter-rouge">  */</code><br />
<code class="highlighter-rouge"> public void mouseMoved(SequenceViewerEvent sve) {</code><br />
<code class="highlighter-rouge">   //Manage the tooltip</code><br />
<code class="highlighter-rouge">   ToolTipManager ttm = ToolTipManager.sharedInstance();</code><br />
<code class="highlighter-rouge">   ttm.setDismissDelay(2000);</code><br />
<code class="highlighter-rouge">   //If the mouse have moved over a SimpleFeatureHolder</code><br />
<code class="highlighter-rouge">   if (sve.getTarget() instanceof SimpleFeatureHolder){</code><br />
<code class="highlighter-rouge">     ComparableTerm gene = RichObjectFactory.getDefaultOntology().getOrCreateTerm("gene");</code><br />
<code class="highlighter-rouge">     SimpleFeatureHolder sfh = (SimpleFeatureHolder)sve.getTarget();</code><br />
<code class="highlighter-rouge">     FeatureHolder fh = sfh.filter(new FeatureFilter.ByType("CDS"));</code><br />
<code class="highlighter-rouge">     Iterator </code><richfeature>` i =  fh.features();`  
`     while(i.hasNext()){`  
`       RichFeature rf = i.next();`  
`       RichAnnotation anno = (RichAnnotation) rf.getAnnotation();`  
`       Set annotationNotes = anno.getNoteSet();`  
`       for (Iterator `</richfeature></p>

<note>
it = annotationNotes.iterator(); it.hasNext();) {

`         Note note = it.next();`  
`         if (note.getTerm().equals(gene)) {`  
`           tsp.setToolTipText("Gene: " + note.getValue());`  
`         }`  
`       }`  
`     }`  
`   }`  
`   else {`  
`     //Remove the tooltip`  
`     ttm.setDismissDelay(10);`  
`   }`  
` }`

` /**`  
`  * Main method`  
`  * @param args`  
`  */`  
` public static void main(String args []){`  
`   if (args.length == 1){`  
`     new DisplaySequenceFile(args[0]);`  
`   }`  
`   else {`  
`     System.out.println("Usage: java SequenceViewer `<embl file="">`");`  
`     System.exit(1);`  
`   }`  
` }`

} 
</embl></note>

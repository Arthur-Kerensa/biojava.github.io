<h2 id="how-do-i-convert-an-xml-blast-result-into-html-page">How do I convert an XML BLAST result into HTML page?</h2>

<p>BioJava contains several classes that allow us to parse both plain and
XML BLAST output. Another way is to make a direct XML to HTML
transformation using an XSL stylesheet. Any modern browser supports such
a transformation directly, but they could produce a little bit different
result. Here is an example how to do it on the “server side” - the
typical task for the web server. First of all the simple java class that
performs the transformation:</p>

<h3 id="blastxml2htmljava">BlastXML2HTML.java</h3>

<java> import java.io.ByteArrayInputStream; import
java.io.FileInputStream; import java.io.FileOutputStream; import
java.io.IOException; import java.io.InputStream; import
java.io.StringWriter;

import javax.xml.transform.OutputKeys; import
javax.xml.transform.Transformer; import
javax.xml.transform.TransformerException; import
javax.xml.transform.TransformerFactory; import
javax.xml.transform.sax.SAXSource; import
javax.xml.transform.stream.StreamResult; import
javax.xml.transform.stream.StreamSource;

import org.xml.sax.EntityResolver; import org.xml.sax.InputSource;
import org.xml.sax.SAXException; import org.xml.sax.XMLReader; import
org.xml.sax.helpers.XMLReaderFactory;

`public class BlastXML2HTML implements EntityResolver`  
`{`  
`   private BlastXML2HTML() {}`  
`   `  
`   public static String toHTML(InputStream xml) throws IOException, TransformerException, SAXException`  
`   {`  
`      Transformer transformer = TransformerFactory.newInstance().newTransformer(new`  
`         StreamSource(BlastXML2HTML.class.getClassLoader().getResourceAsStream("blast.xsl")));`

`      transformer.setOutputProperty(OutputKeys.METHOD, "html");`  
`      `  
`      StringWriter writer = new StringWriter();`  
`      `  
`      // avoid dtd validation...`  
`      XMLReader reader = XMLReaderFactory.createXMLReader();`  
`      reader.setEntityResolver(new BlastXML2HTML());`  
`      `  
`      transformer.transform(new SAXSource(reader, new InputSource(xml)), new StreamResult(writer));`  
`      `  
`      return writer.toString();       `  
`   }`

`   public InputSource resolveEntity(String publicId, String systemId) throws SAXException, IOException`  
`   {`  
`      return new InputSource(new ByteArrayInputStream(new byte[0]));`  
`   }`  
`   `  
`   public static void main(String[] args) throws Exception`  
`   {`  
`       InputStream in = new FileInputStream("C:/temp/blast.xml");       `  
`       FileOutputStream out = new FileOutputStream("C:/temp/blast.html");`  
`       `  
`       out.write(toHTML(in).getBytes());`  
`       out.close();`  
`   }`  
`}`

</java>

<p>The only way to use this class is to call a static method toHTML()
passing the xml stream as a parameter. You can see the main method as an
example of usage - it takes “<strong>blast.xml</strong>” file and transforms it into
“<strong>blast.html</strong>” one.</p>

<p>Actually this code is quite generic and can be used to transform any xml
to any other document.</p>

<p>The most important thing here is the “<strong>blast.xsl</strong>” stylesheet. The
code is looking for the stylesheet in the classpath, so one should be
provided along with code.</p>

<p>Here is an example of such transformation stylesheet:</p>

<div class="highlighter-rouge"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;</span>

<span class="nt">&lt;xsl:stylesheet</span> <span class="na">version=</span><span class="s">"1.0"</span>
<span class="na">xmlns:xsl=</span><span class="s">"http://www.w3.org/1999/XSL/Transform"</span><span class="nt">&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"/"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;body&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;xsl:apply-templates</span> <span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"BlastOutput"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;table</span> <span class="na">style=</span><span class="s">"width: 100%; white-space: nowrap; background-color: #66CCFF;"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">colspan=</span><span class="s">"3"</span> <span class="na">style=</span><span class="s">"text-align: left; font-size: xx-large;"</span><span class="nt">&gt;</span>
        Sequence Similarity Report
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;tr&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"text-align: right; font-size: large;"</span><span class="nt">&gt;</span>Search Program:<span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"BlastOutput_program"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"BlastOutput_version"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/td&gt;</span>
      <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"width: 100%"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"BlastOutput_param"</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/table&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 100%; text-align: center; font-size: x-large; background-color: #66FFCC"</span><span class="nt">&gt;</span>
    Detailed Analysis of Results
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"BlastOutput_iterations"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"BlastOutput_param"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"text-align: right; font-size: large;"</span><span class="nt">&gt;</span>
      Parameters:
    <span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td</span> <span class="na">style=</span><span class="s">"text-align: left; font-size: medium;"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:for-each</span> <span class="na">select=</span><span class="s">"Parameters/*"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"lname"</span> <span class="na">select=</span><span class="s">"local-name()"</span> <span class="nt">/&gt;</span>

          <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"$lname='Parameters_matrix'"</span><span class="nt">&gt;</span>
            Matrix:
          <span class="nt">&lt;/xsl:if&gt;</span>
          <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"$lname='Parameters_expect'"</span><span class="nt">&gt;</span>
            Expected:
          <span class="nt">&lt;/xsl:if&gt;</span>
          <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"$lname='Parameters_gap-open'"</span><span class="nt">&gt;</span>
            gap_open:
          <span class="nt">&lt;/xsl:if&gt;</span>
          <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">"$lname='Parameters_gap-extend'"</span><span class="nt">&gt;</span>
            gap_extend:
          <span class="nt">&lt;/xsl:if&gt;</span>

        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"."</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/xsl:for-each&gt;</span>
    <span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"BlastOutput_iterations/Iteration"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 100%; background-color: #FFFFCC;"</span><span class="nt">&gt;</span>
      Iteration:
      <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Iteration_iter-num/."</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"Iteration_hits"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"Iteration_hits/Hit"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 100%; background-color: #FFFF99;"</span><span class="nt">&gt;</span>
    Hit Id: <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hit_id/."</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hit_def/."</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;br/&gt;</span>
    Sequence length of hit = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hit_len/."</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;xsl:apply-templates</span> <span class="na">select=</span><span class="s">"Hit_hsps"</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">match=</span><span class="s">"Hit_hsps/Hsp"</span><span class="nt">&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 100%; background-color: #FFEEFF;"</span><span class="nt">&gt;</span>
    
    High-scoring segment pair (HSP) group
    <span class="nt">&lt;br/&gt;</span>
    Score = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hsp_score/."</span><span class="nt">/&gt;</span>,
    E = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hsp_evalue/."</span><span class="nt">/&gt;</span>,

    <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"length"</span> <span class="na">select=</span><span class="s">"Hsp_align-len/."</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"identity"</span> <span class="na">select=</span><span class="s">"Hsp_identity/."</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"positive"</span> <span class="na">select=</span><span class="s">"Hsp_positive/."</span> <span class="nt">/&gt;</span>

    Identities = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$identity"</span><span class="nt">/&gt;</span>/
                 <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$length"</span><span class="nt">/&gt;</span>
                 (<span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"format-number($identity div $length, '##.#%')"</span><span class="nt">/&gt;</span>),

    Positives = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$positive"</span><span class="nt">/&gt;</span>/
                <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$length"</span><span class="nt">/&gt;</span>
                 (<span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"format-number($positive div $length, '##.#%')"</span><span class="nt">/&gt;</span>),

    Length = <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"Hsp_align-len/."</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"width: 100%; text-align: left; font-family: courier;"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'align'</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'Hsp_qseq/.'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'mseq'</span> <span class="na">select=</span><span class="s">'Hsp_midline/.'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'Hsp_hseq/.'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:call-template&gt;</span>

  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;br/&gt;</span>

<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">'align'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'qseq'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'hseq'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'mseq'</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;br/&gt;</span>
    <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">'string-length($qseq) != 0'</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:choose&gt;</span>  
        <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">'string-length($qseq) &amp;gt; 80 '</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'align80'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'substring($qseq, 1, 80)'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'substring($hseq, 1, 80)'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'mseq'</span> <span class="na">select=</span><span class="s">'substring($mseq, 1, 80)'</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>

          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'align'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'substring($qseq, 51, string-length($qseq) - 80)'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'substring($hseq, 51, string-length($hseq) - 80)'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'mseq'</span> <span class="na">select=</span><span class="s">'substring($mseq, 51, string-length($mseq) - 80)'</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>

        <span class="nt">&lt;/xsl:when&gt;</span>
        <span class="nt">&lt;xsl:otherwise&gt;</span>
          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'align80'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'$qseq'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'$hseq'</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'mseq'</span> <span class="na">select=</span><span class="s">'$mseq'</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>
        <span class="nt">&lt;/xsl:otherwise&gt;</span>
      <span class="nt">&lt;/xsl:choose&gt;</span>
    <span class="nt">&lt;/xsl:if&gt;</span>

<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">'align80'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'qseq'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'hseq'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'mseq'</span><span class="nt">/&gt;</span>
  
    <span class="ni">&amp;#xA0;&amp;#xA0;&amp;#xA0;</span>
    <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'highligth'</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'$qseq'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'$hseq'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:call-template&gt;</span>
    <span class="nt">&lt;br/&gt;</span>

    <span class="ni">&amp;#xA0;&amp;#xA0;&amp;#xA0;</span>
    <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"whitespace"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">select=</span><span class="s">"$mseq"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:call-template&gt;</span>    
    <span class="nt">&lt;br/&gt;</span>

    <span class="ni">&amp;#xA0;&amp;#xA0;&amp;#xA0;</span>
    <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'highligth'</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'$hseq'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'$qseq'</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:call-template&gt;</span>
    <span class="nt">&lt;br/&gt;</span>

<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">'highligth'</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'qseq'</span><span class="nt">/&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">'hseq'</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;xsl:if</span> <span class="na">test=</span><span class="s">'string-length($qseq) != 0'</span> <span class="nt">&gt;</span>
      <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"q_char"</span> <span class="na">select=</span><span class="s">"substring($qseq, 1, 1)"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"h_char"</span> <span class="na">select=</span><span class="s">"substring($hseq, 1, 1)"</span> <span class="nt">/&gt;</span>

      <span class="nt">&lt;xsl:choose&gt;</span>
        <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">'$q_char = $h_char'</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$q_char"</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;/xsl:when&gt;</span>
        <span class="nt">&lt;xsl:otherwise&gt;</span>
          <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'colorer'</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'char'</span> <span class="na">select=</span><span class="s">'$q_char'</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/xsl:call-template&gt;</span>
        <span class="nt">&lt;/xsl:otherwise&gt;</span>
      <span class="nt">&lt;/xsl:choose&gt;</span>

      <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">'highligth'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'qseq'</span> <span class="na">select=</span><span class="s">'substring($qseq, 2, string-length($qseq) - 1)'</span><span class="nt">/&gt;</span>
        <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">'hseq'</span> <span class="na">select=</span><span class="s">'substring($hseq, 2, string-length($hseq) - 1)'</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/xsl:call-template&gt;</span>

    <span class="nt">&lt;/xsl:if&gt;</span>

<span class="nt">&lt;/xsl:template&gt;</span>
  
<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">"colorer"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"char"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;xsl:choose&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='A'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='C'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='L'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='I'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='V'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='M'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #C8FFC8;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='G'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #DCC0FF;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='P'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #DCC0FF;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='S'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFFCA0;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='T'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFFCA0;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='N'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFFCA0;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='Q'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFFCA0;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='K'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFA2A2;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='R'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #FFA2A2;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='D'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #A2E2FF;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='E'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #A2E2FF;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='H'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #50FF50;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='Y'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #50FF50;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='W'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #50FF50;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"$char='F'"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;font</span> <span class="na">style=</span><span class="s">'background-color: #50FF50;'</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/font&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span>
    <span class="nt">&lt;xsl:otherwise&gt;</span>
        <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$char"</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/xsl:otherwise&gt;</span>

  <span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>


<span class="nt">&lt;xsl:template</span> <span class="na">name=</span><span class="s">"whitespace"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xsl:param</span> <span class="na">name=</span><span class="s">"text"</span><span class="nt">/&gt;</span>

  <span class="nt">&lt;xsl:choose&gt;</span>
    <span class="nt">&lt;xsl:when</span> <span class="na">test=</span><span class="s">"contains($text, ' ')"</span><span class="nt">&gt;</span>

      <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"before"</span> <span class="na">select=</span><span class="s">"substring-before($text, ' ')"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:variable</span> <span class="na">name=</span><span class="s">"after"</span> <span class="na">select=</span><span class="s">"substring-after($text, ' ')"</span><span class="nt">/&gt;</span>

      <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$before"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"'&amp;#xA0;'"</span><span class="nt">/&gt;</span>

      <span class="nt">&lt;xsl:call-template</span> <span class="na">name=</span><span class="s">"whitespace"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xsl:with-param</span> <span class="na">name=</span><span class="s">"text"</span> <span class="na">select=</span><span class="s">"$after"</span><span class="nt">/&gt;</span>
      <span class="nt">&lt;/xsl:call-template&gt;</span>
    <span class="nt">&lt;/xsl:when&gt;</span> 
    <span class="nt">&lt;xsl:otherwise&gt;</span>
      <span class="nt">&lt;xsl:value-of</span> <span class="na">select=</span><span class="s">"$text"</span><span class="nt">/&gt;</span>  
    <span class="nt">&lt;/xsl:otherwise&gt;</span>
  <span class="nt">&lt;/xsl:choose&gt;</span>            
 <span class="nt">&lt;/xsl:template&gt;</span>
<span class="nt">&lt;/xsl:stylesheet&gt;</span>
</code></pre>
</div>

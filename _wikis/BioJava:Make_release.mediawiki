==How to make a BioJava release==

This page is intended for BioJava release managers. I was documenting this while I was doing the BioJava 1.7 release. --[[User:Andreas|Andreas]] 15:14, 12 April 2009 (UTC)

===Required time===
A few hours. Most time is being spent in verifying that the code base is release ready. The actual preparation of the .jar files and copying them to the open-bio.org server is quite quick and can be done semi-automatic.

===Prior to release===
* Announce release deadlines on mailing list

=== Configure Authentication Keys ===

To complete the release you need permission to scp files to the maven repository on cloudportal.open-bio.org. If you need help with that, talk to root@open-bio.org. Make sure you have ssh keys set up to log in, and that you are a member of the apache group so that you can write to the web directory.

You also need to configure maven with your username and identity file. In ~/.m2/settings.xml (on the build machine), add or merge the following xml:

 <settings xmlns="http://maven.apache.org/SETTINGS/1.0.0"
     xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
     xsi:schemaLocation="http://maven.apache.org/SETTINGS/1.0.0
     http://maven.apache.org/xsd/settings-1.0.0.xsd">
     <localRepository/>
     <interactiveMode/>
     <usePluginRegistry/>
     <offline/>
     <pluginGroups/>
     <mirrors/>
     <proxies/>
     <profiles/>
     <activeProfiles/>
     <servers>
         <server>
             <id>biojava-maven-repo</id>
             <username>username</username>
             <privateKey>/full/path/to/.ssh/id_rsa</privateKey>
         </server>
     </servers>
 </settings>

Maven reports 'Auth Error' in the release:perform stage if you keys are not properly set up. Permissions errors mean that authentication was successful but you can not write to the correct location (for instance, if a maven-metadata.xml exists from a previous build by another user).

==On release date==

'''Verify code base'''

* Make sure code is ready for release. Check last minute commits (there usually are some).
* Make sure the auto-build page (cruisecontrol) does not report any problems

== Clean checkout ==

Create a clean clone on a machine with ssh keys set up to access cloudportal.open-bio.org (and associated maven settings; see above).

 git clone git@github.com:biojava/biojava.git bj3.0.7


===Make maven release===

the release process is very straightforward nowadays. It is rather time-consuming, as maven runs all tests during each step. 

 mvn release:clean 
 mvn release:prepare 
 mvn release:perform

The second and third steps set up your local git repository and deploy jar files for each module to cloudportal. If something goes wrong, you can technically run `mvn release:rollback`, but it is easier to just reset your git repository to master.

 git reset --hard origin/master

===Push to Github===

If all three steps work fine, push the tag to github and merge it to releases. Note that I'm assuming origin refers to the central biojava repository.

<span style="color:red">Note: double check these commands</span>

 git pull master #merge any commits that occurred while releasing
 git push --tags origin master #push the new master (with updated pom) and new tags

 git checkout release
 git merge biojava-3.0.7
 git diff biojava-3.0.7 release #shouldn't print anything
 git push origin release

Now the release is official!

===Prepare and release javadoc files===
(Still in git checkout, e.g. bj3.0.7 if you're following along or biojava-git/target/checkout/ if you're andreas)

build javadoc:

 mvn site


Here we assume the version nr. of the current release is 3.0.7.
  cd target/site/
  mv apidocs/ api3.0.7
  tar czvf api3.0.3.tar.gz api3.0.7/
  scp api3.0.7.tar.gz username@cloudportal.open-bio.org:/home/websites/biojava.org/html/static/docs/

now log into the couldportal server:

 ssh andreas@cloudportal.open-bio.org
 
 cd /home/websites/biojava.org/html/static/docs/
 tar zxvf api3.0.7.tar.gz
 rm api
 ln -s api3.0.7 api

and back to your local machine...

=== Create the biojava-all bundle ===

If needed, rename your git checkout to bj3.0.7

 mv checkout/ bj3.0.7

remove .git files

 rm -rf .git .gitignore .travis.yml KEYS ignore.txt

Create -all tarball

 cd ..
 tar czvf bj3.0.7-all.tar.gz bj3.0.7
 
on portal.open-bio

 mkdir /home/websites/biojava.org/html/static/download/bj3.0.7

back to your local machine

 scp biojava-3.0.7-all.tar.gz andreas@cloudportal.open-bio.org:/home/websites/biojava.org/html/static/download/bj3.0.7

=== Javadocs ===

this is how to enable analytics in javadocs

 cd biojava-svn/target/bj3.0.7/

 mvn clean install source:jar javadoc:jar deploy javadoc:aggregate

 cd biojava-svn/target/bj3.0.7/target/site/apidocs

upload apidocs

=== Update the wiki pages to link to the new release===

Create a new download file for the release. (I copied [[BioJava:Download_3.0.4]] to [[BioJava:Download_3.0.5]]). Modify the new page to the latest data.

Update [[BioJava:Download]] (Change the redirect on the BioJava:Download page to [[BioJava:Download_3.0.5]])

Update the [[MediaWiki:Sidebar]] to point to the new Javadoc api

Update the main page via [[Template:BioJava_Documentation]] and [[Template:CookBook]]

Add release announcement to [[Current events]]

Search for additional references to the old version: [http://biojava.org/w/index.php?title=Special%3ASearch&profile=advanced&fulltext=Search&ns0=1&ns4=1&redirs=1&search=3.0.8 Advanced Search]

=== AND FINALLY ===

Write release announcement to biojava-l and biojava-dev
==How to make a BioJava release==

This page is intended for BioJava release managers. I was documenting this while I was doing the BioJava 1.7 release. --[[User:Andreas|Andreas]] 15:14, 12 April 2009 (UTC)

===Required time===
A few hours. Most time is being spent in verifying that the code base is release ready. The actual preparation of the .jar files and copying them to the open-bio.org server is quite quick and can be done semi-automatic.

===Prior to release===
* Announce release deadlines on mailing list

=== Prepare your release server ===

Make sure you have access to a server that has the ssh keys setup for cloudportal.open-bio.org. If you need help with that, talk to root@open-bio.org.

==On release date==

'''Verify code base'''

* Make sure code is ready for release. Check last minute commits (there usually are some).
* Make sure the auto-build page (cruisecontrol) does not report any problems

===Make maven release===

the release process is very straightforward nowadays. 

 mvn release:clean 

 mvn release:prepare 

 mvn release:perform

If all three steps work fine, the biggest part of the release has been completed!. The next steps are just updates of documentation. If something went wrong you can reset the release process by doing:

 mvn release:rollback

===Prepare and release javadoc files===

 cd biojava-svn/target/checkout/

remove .svn files  (fore preparing -all file)

 find ./ -name ".svn" | xargs rm -Rf

build javadoc:

 mvn site

 cd biojava-svn/target/checkout/target/site/

  mv apidocs/ api3.0.3

  tar cvf api3.0.3.tar api3.0.3/
 
  gzip api3.0.3.tar

  scp api3.0.3.tar.gz username@cloudportal.open-bio.org:/home/websites/biojava.org/html/static/docs/

 ssh andreas@cloudportal.open-bio.org

 cd /home/websites/biojava.org/html/static/docs/

 tar zxvf api3.0.4.tar.gz

 rm api
 
  ln -s api3.0.3 api


[andreas@emmy target]$ pwd/opt/cruise/projects/biojava-svn/target
[andreas@emmy target]$ mv checkout/ bj3.0.3
[andreas@emmy target]$ tar zcvf bj3.0.3.tar.gz bj3.0.3

[andreas@emmy target]$ mv bj3.0.3.tar.gz biojava-3.0.3-all.tar.gz
 

on portal.open-bio
cd /home/websites/biojava.org/html/static/download

mkdir bj3.0.3

emmy:
scp biojava-3.0.3-all.tar.gz andreas@portal.open-bio.org:/home/websites/biojava.org/html/static/download/bj3.0.3


GOOGLE DOCS:

cd /opt/cruise/projects/biojava-svn/target/bj3.0.4/
mvn clean install source:jar javadoc:jar deploy javadoc:aggregate

cd /opt/cruise/projects/biojava-svn/target/bj3.0.4/target/site/apidocs

===Copy files to portal.open-bio.org ===
* Log into the portal.open-bio.org server. go to /home/websites/biojava.org/html/static/download/ and create a new directory for the new release. See directory structure in other release how to organise this.

* Copy file biojava-all.jar
 scp biojava-1.8.2-all.jar username@portal.open-bio.org:/home/websites/biojava.org/html/static/download/bj18/all

'''Back in your local checkout'''
* remove the /dist subdirectory from your checkout. Not needed any longer.
* Make the doc release bundle
 ant clean; ant javadocs-all; cd ant-build; jar cvf biojava-1.8.2-doc.jar docs/
* Copy file biojava-doc.jar
 scp biojava-1.8.2-doc.jar username@portal.open-bio.org:/home/websites/biojava.org/html/static/download/bj18/doc/biojava-docs.jar
* Prepare the bin release: 
 ant clean; ant
* Copy file biojava.jar 
 scp ant-build/biojava.jar username@portal.open-bio.org:/home/websites/biojava.org/html/static/download/bj18/bin/
* Prepare the src release:
 ant clean; cd .. ; jar cvf biojava-1.8.2-src.jar biojava-live
 scp biojava-1.8.2-src.jar username@portal.open-bio.org:/home/websites/biojava.org/html/static/download/bj18/src/

=== Update Javadoc docu on portal.open-bio.org===

Almost done... The last thing is to update the public javadoc files.
For this, we need to recompile the javadocs and add a hook to the google analytics tracker, we are using on the website. use the modified [[BioJava:my_build_biojava|my_build_biojava.xml]]. (update the version variable in the file to your release number)
 ant -buildfile my_build_biojava.xml javadocs-biojava
Then copy the newly created javadoc files to the public server.
 cd ant-build/docs/; tar cvf javadocs-server.tar ./biojava/
 scp javadocs-server.tar username@portal.open-bio.org:~/
The files are now in your home directory on the server. Untar the files on portal.open-bio.org:
 tar xvf javadocs-server.tar
The files are now in your home directory on the server. We need to hook them into the frontend:
 cd /home/websites/biojava.org/html/static/docs/
 mkdir api18
 cp -r ~/biojava/* ./api18/
verify that all went ok by pointing your browser to
 http://www.biojava.org/docs/api18/
update the symbolic link to the javadoc api
 point /home/websites/biojava.org/html/static/docs/api to api18

=== Update the wikipedia pages to link to the new release===

Create a new download file for the release. (I copied [[BioJava:Download_1.6]] to [[BioJava:Download_1.7]]). Modify the new page to the latest data.

Update [[BioJava:Download]] (Change the redirect on the BioJava:Download page to [[BioJava:Download_1.8]])

Update the [[MediaWiki:Sidebar]] to point to the new Javadoc api

=== AND FINALLY ===

Write release announcement to biojava-l and biojava-dev